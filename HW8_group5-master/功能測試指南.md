# 台北咖啡廳搜尋引擎 - 功能測試指南

## 📋 系統架構說明

### 後端架構 (Java Spring Boot)

```
src/main/java/com/example/GoogleQuery/
├── GoogleQueryApplication.java          # Spring Boot 主程式
├── config/
│   ├── CacheConfig.java                 # 快取配置
│   ├── DataLoaderConfig.java            # 資料載入配置（載入 cafes.json, keywords.json 等）
│   └── WebConfig.java                   # Web 配置（CORS 等）
├── controller/                          # API 端點
│   ├── SearchController.java            # 搜尋 API: /api/search
│   ├── FilterController.java            # 篩選 API: /api/filters
│   ├── RecommendationController.java    # 推薦 API: /api/recommendations
│   ├── FavoriteController.java          # 收藏 API（前端 LocalStorage）
│   ├── HistoryController.java           # 歷史紀錄 API（前端 LocalStorage）
│   └── ErrorReportController.java       # 錯誤回報 API
├── core/                                # 核心搜尋引擎
│   ├── SearchEngine.java                # 搜尋引擎主邏輯
│   ├── Ranker.java                      # 排名計算器
│   ├── KeywordParser.java               # 關鍵字解析器
│   ├── HashtagGenerator.java            # Hashtag 生成器
│   └── BaselineScoreCalculator.java     # 基準分數計算器
├── service/                             # 業務邏輯層
│   ├── SearchService.java               # 搜尋服務（整合所有功能）
│   ├── KeywordService.java              # 關鍵字管理（權重、分層）
│   ├── RankingService.java              # 排名服務（計算分數）
│   ├── HashtagService.java              # Hashtag 服務
│   ├── PreviewService.java              # 預覽服務（抓取網站摘要）
│   ├── FilterService.java               # 篩選服務（地區、功能）
│   └── RecommendationService.java       # 推薦服務（baseline score）
├── repository/                          # 資料存取層
│   ├── CafeRepository.java              # 咖啡廳資料存取
│   └── KeywordRepository.java           # 關鍵字資料存取
├── model/                               # 資料模型
│   ├── Cafe.java                        # 咖啡廳模型
│   ├── Keyword.java                     # 關鍵字模型
│   ├── SearchResult.java                # 搜尋結果模型
│   ├── WebPage.java                     # 網頁模型
│   └── WebTree.java                     # 網站樹狀結構（多層爬取）
├── util/                                # 工具類別
│   ├── ChineseTokenizer.java            # 中文分詞器
│   ├── StopWordsFilter.java             # 停用詞過濾器
│   └── ValidationUtil.java              # 驗證工具
└── filter/
    └── CorsFilter.java                  # CORS 過濾器
```

### 前端架構 (HTML/CSS/JavaScript)

```
src/main/resources/static/
├── index.html                           # 主頁面
├── favorites.html                       # 收藏頁面
├── css/
│   ├── style.css                        # 主要樣式
│   └── components.css                   # 組件樣式
└── js/
    ├── app.js                           # 主應用程式邏輯
    ├── search.js                        # 搜尋功能
    ├── filter.js                        # 篩選功能
    ├── favorite.js                      # 收藏功能（LocalStorage）
    ├── history.js                       # 瀏覽紀錄（LocalStorage）
    ├── report.js                        # 錯誤回報功能
    ├── data-loader.js                   # Mock 資料載入器（備用）
    └── utils.js                         # 工具函數
```

### 資料檔案

```
src/main/resources/data/
├── cafes.json                           # 30 家咖啡廳資料
├── keywords.json                        # 關鍵字清單與權重
├── baseline-scores.json                 # 預先計算的基準分數
├── features.json                        # 功能列表（不限時、有插座等）
├── districts.json                       # 台北市行政區列表
├── keyword-translations.json            # 多語言關鍵字對照
└── stopwords.txt                        # 停用詞列表
```

---

## ✅ 核心功能測試清單

### 1. ✨ 基礎搜尋功能

**測試步驟：**
1. 開啟瀏覽器訪問 `http://localhost:8080`
2. 在搜尋框輸入：`不限時`
3. 按下搜尋按鈕或 Enter

**預期結果：**
- ✅ 顯示包含「不限時」關鍵字的咖啡廳列表
- ✅ 結果按分數由高到低排序
- ✅ 每個結果顯示：店名、分數、地址、預覽文字、Hashtags

**測試關鍵字範例：**
- `安靜` - 應該顯示安靜的咖啡廳
- `有插座` - 應該顯示有插座的咖啡廳
- `wifi` - 應該顯示有 wifi 的咖啡廳
- `文青` - 應該顯示文青風格的咖啡廳
- `不限時 安靜` - 應該顯示同時符合兩個條件的咖啡廳

**API 測試：**
```bash
# PowerShell 測試指令
Invoke-RestMethod -Uri "http://localhost:8080/api/search?q=不限時" -Method GET
```

---

### 2. 🔍 關鍵字解析與權重計算

**系統如何運作：**
1. 使用者輸入關鍵字 → `KeywordParser` 解析
2. `ChineseTokenizer` 進行中文分詞
3. `StopWordsFilter` 過濾停用詞
4. `KeywordService` 查找關鍵字權重：
   - **Tier 1 關鍵字**（權重 2.0-3.0）：不限時、安靜、有插座、wifi 等
   - **Tier 2 關鍵字**（權重 1.0-1.9）：文青、咖啡、閱讀等
   - **Tier 3 關鍵字**（權重 0.5-1.0）：環境、氛圍等
5. `RankingService` 計算每家咖啡廳的分數
6. `Ranker` 排序結果

**測試步驟：**
1. 搜尋 `不限時` → 應該得到高分（Tier 1 關鍵字）
2. 搜尋 `文青` → 應該得到中等分數（Tier 2 關鍵字）
3. 搜尋 `氛圍` → 應該得到較低分數（Tier 3 關鍵字）

**驗證方式：**
- 查看搜尋結果的 `score` 欄位
- Tier 1 關鍵字的結果分數應該 > Tier 2 > Tier 3

---

### 3. 📊 分數計算與排序

**計算公式：**
```
總分 = Σ (關鍵字出現次數 × 關鍵字權重)
```

**測試步驟：**
1. 搜尋 `安靜`
2. 查看結果列表

**預期結果：**
- ✅ 結果按分數由高到低排序
- ✅ 多次包含「安靜」關鍵字的咖啡廳分數更高
- ✅ 同時包含多個相關關鍵字的咖啡廳排名更前

**驗證分數：**
在 Chrome DevTools Console 執行：
```javascript
// 查看搜尋結果的分數
console.table(window.searchManager.currentResults.map(r => ({
    name: r.name,
    score: r.score,
    keywords: r.keywords
})));
```

---

### 4. 🏷️ Hashtag 生成

**Hashtag 生成邏輯：**
1. 從使用者輸入抽取最多 2 個重要詞彙
2. 從咖啡廳內容中挑出出現次數最多的 3 個 domain keywords
3. 合併成最多 5 個 Hashtag
4. 過濾掉停用詞和超長句子

**測試步驟：**
1. 搜尋 `不限時 安靜`
2. 查看搜尋結果卡片

**預期結果：**
- ✅ 每個結果顯示 3-5 個 Hashtags
- ✅ Hashtags 包含使用者輸入的關鍵字（如 #不限時 #安靜）
- ✅ Hashtags 包含該咖啡廳的特色（如 #有插座 #wifi #文青）
- ✅ 不包含停用詞（的、是、在、等）

---

### 5. 📝 預覽文字 (Preview/Snippet)

**預覽生成方式：**
- 從 `cafes.json` 中的 `preview` 欄位讀取
- 或由 `PreviewService` 使用 Jsoup 從網站抓取前幾句內容

**測試步驟：**
1. 執行任意搜尋
2. 查看每個結果卡片下方的預覽文字

**預期結果：**
- ✅ 每個咖啡廳顯示 1-2 行預覽文字
- ✅ 預覽文字簡潔且相關
- ✅ 預覽文字不超過 100 字

---

### 6. 🗺️ 地區篩選

**測試步驟：**
1. 在首頁點擊「地區篩選」按鈕
2. 選擇一個或多個地區（如：大安區、中山區）
3. 執行搜尋或查看推薦

**預期結果：**
- ✅ 只顯示選定地區的咖啡廳
- ✅ 可以複選多個地區
- ✅ 取消選擇後恢復顯示所有地區

**可用地區：**
- 大安區、中山區、內湖區、文山區、信義區、松山區
- 中正區、萬華區、士林區、北投區、南港區、大同區

**API 測試：**
```bash
# 搜尋大安區的咖啡廳
Invoke-RestMethod -Uri "http://localhost:8080/api/search/advanced?keyword=咖啡&districts=大安區" -Method GET
```

---

### 7. ⚙️ 功能篩選

**可用功能：**
- 不限時、有插座、安靜、有wifi
- 早餐、午餐、晚餐、甜點
- 戶外座位、寵物友善、停車場、無障礙

**測試步驟：**
1. 點擊「功能篩選」按鈕
2. 選擇一個或多個功能（如：不限時 + 有插座）
3. 執行搜尋

**預期結果：**
- ✅ 只顯示符合所選功能的咖啡廳
- ✅ 可以複選多個功能
- ✅ 結果仍按分數排序

**API 測試：**
```bash
# 搜尋不限時且有插座的咖啡廳
Invoke-RestMethod -Uri "http://localhost:8080/api/search/advanced?keyword=咖啡&features=不限時,有插座" -Method GET
```

---

### 8. 🌟 熱門咖啡廳推薦

**推薦機制：**
- 使用預先計算的 `baseline-scores.json`
- 基於所有關鍵字的綜合評分
- 不依賴使用者輸入

**測試步驟：**
1. 開啟首頁（不輸入任何關鍵字）
2. 查看「熱門推薦」區域

**預期結果：**
- ✅ 顯示 6-10 家推薦咖啡廳
- ✅ 按 baseline score 排序
- ✅ 可以套用地區/功能篩選

**API 測試：**
```bash
# 取得熱門推薦
Invoke-RestMethod -Uri "http://localhost:8080/api/recommendations" -Method GET
```

---

### 9. 📍 地址與 Google Maps 連結

**測試步驟：**
1. 執行任意搜尋
2. 點擊任一咖啡廳結果的地址

**預期結果：**
- ✅ 自動開啟新分頁連結到 Google Maps
- ✅ 顯示該咖啡廳的正確位置
- ✅ 地址格式：`臺北市○○區○○路○○號`

**地址連結格式：**
```html
<a href="https://www.google.com/maps/search/?api=1&query=臺北市大安區永康街37巷12號" target="_blank">
    臺北市大安區永康街37巷12號
</a>
```

---

### 10. ❤️ 收藏功能

**測試步驟：**
1. 在搜尋結果中點擊任一咖啡廳的「收藏」按鈕（❤️）
2. 點擊右上角「收藏清單」按鈕
3. 或訪問 `http://localhost:8080/favorites.html`

**預期結果：**
- ✅ 點擊收藏按鈕後圖示變為實心 ❤️
- ✅ 收藏清單顯示所有已收藏的咖啡廳
- ✅ 可以從收藏清單移除
- ✅ 重新整理頁面後收藏仍保留（使用 LocalStorage）

**驗證 LocalStorage：**
在 Chrome DevTools Console 執行：
```javascript
// 查看收藏清單
JSON.parse(localStorage.getItem('favorites'))
```

---

### 11. 🕒 最近瀏覽紀錄

**測試步驟：**
1. 點擊幾家咖啡廳的標題或連結
2. 點擊右上角「瀏覽紀錄」按鈕

**預期結果：**
- ✅ 顯示最近點擊過的咖啡廳（最多 10 筆）
- ✅ 按時間倒序排列（最新的在前）
- ✅ 可以從紀錄直接訪問咖啡廳
- ✅ 可以清除瀏覽紀錄
- ✅ 重新整理頁面後紀錄仍保留（使用 LocalStorage）

**驗證 LocalStorage：**
```javascript
// 查看瀏覽紀錄
JSON.parse(localStorage.getItem('history'))
```

---

### 12. 🚨 錯誤回報功能

**測試步驟：**
1. 點擊右上角「回報資訊有誤」按鈕
2. 選擇要回報的咖啡廳
3. 選擇錯誤類型（如：已關閉、資訊過期等）
4. 填寫詳細說明
5. 提交回報

**預期結果：**
- ✅ 顯示回報表單
- ✅ 可以選擇咖啡廳和錯誤類型
- ✅ 提交成功顯示確認訊息
- ✅ 後端接收並記錄回報

**API 測試：**
```bash
# 提交錯誤回報
Invoke-RestMethod -Uri "http://localhost:8080/api/error-reports" -Method POST `
  -ContentType "application/json" `
  -Body '{"cafeId":"cafe_001","type":"資訊過期","description":"限時規則已改變"}'
```

---

### 13. 🌏 多語言關鍵字支援

**支援語言：**
- 中文（繁體）
- 英文
- 日文（部分）

**測試步驟：**
1. 使用英文關鍵字搜尋：`quiet`、`wifi`、`unlimited time`
2. 使用日文關鍵字搜尋：`静か`、`wifi`

**預期結果：**
- ✅ 英文關鍵字能正確對應到中文關鍵字
- ✅ 搜尋結果與中文關鍵字相同
- ✅ `keyword-translations.json` 定義語言對照表

**翻譯對照範例：**
```json
{
  "quiet": "安靜",
  "wifi": "wifi",
  "unlimited time": "不限時",
  "静か": "安靜"
}
```

---

## 🔧 開發者測試工具

### 查看所有關鍵字與權重

**API 端點：**
```bash
Invoke-RestMethod -Uri "http://localhost:8080/api/keywords" -Method GET
```

**預期輸出：**
```json
{
  "tier1": [
    {"keyword": "不限時", "weight": 3.0},
    {"keyword": "安靜", "weight": 2.8},
    {"keyword": "有插座", "weight": 2.5}
  ],
  "tier2": [...],
  "tier3": [...]
}
```

### 查看所有咖啡廳

**API 端點：**
```bash
Invoke-RestMethod -Uri "http://localhost:8080/api/cafes" -Method GET
```

### 查看基準分數

**API 端點：**
```bash
Invoke-RestMethod -Uri "http://localhost:8080/api/baseline-scores" -Method GET
```

### 查看可用地區

**API 端點：**
```bash
Invoke-RestMethod -Uri "http://localhost:8080/api/filters/districts" -Method GET
```

### 查看可用功能

**API 端點：**
```bash
Invoke-RestMethod -Uri "http://localhost:8080/api/filters/features" -Method GET
```

---

## 🐛 常見問題排除

### 1. 搜尋沒有結果

**可能原因：**
- 關鍵字不在 domain keywords 列表中
- 關鍵字拼寫錯誤
- 停用詞被過濾掉

**解決方式：**
- 檢查 `keywords.json` 確認關鍵字存在
- 嘗試使用更常見的關鍵字
- 查看 Console 的除錯訊息

### 2. 分數計算不正確

**檢查項目：**
- 確認 `keywords.json` 權重設定正確
- 確認 `cafes.json` 的 keywords 欄位包含正確關鍵字
- 查看 `RankingService` 的計算邏輯

### 3. 地區篩選無效

**檢查項目：**
- 確認 `districts.json` 包含所有地區
- 確認 `cafes.json` 的 district 欄位格式正確
- 查看 `FilterService` 的篩選邏輯

### 4. Hashtag 不顯示

**檢查項目：**
- 確認 `HashtagService` 正常運作
- 確認 `cafes.json` 的 hashtags 欄位存在
- 查看前端 JavaScript Console 錯誤訊息

---

## 📈 效能測試

### 搜尋速度測試

**測試方式：**
```javascript
// 在 Chrome DevTools Console 執行
console.time('search');
await window.searchManager.search('不限時');
console.timeEnd('search');
```

**預期結果：**
- ✅ 搜尋時間 < 200ms（30 家咖啡廳）
- ✅ 載入頁面時間 < 1 秒

### 並發測試

**測試方式：**
```bash
# 使用 Apache Bench 測試
ab -n 100 -c 10 http://localhost:8080/api/search?q=不限時
```

---

## ✨ 進階功能（選做）

### 1. 錯字修正（未實作）
- 拼音相似度
- 編輯距離（Levenshtein Distance）

### 2. 查詢建議（未實作）
- 自動完成
- 相關搜尋建議

### 3. 更智慧的排名（未實作）
- TF-IDF
- PageRank
- BM25

---

## 📊 測試完成檢查表

請在測試完成後勾選：

- [ ] 1. 基礎搜尋功能
- [ ] 2. 關鍵字解析與權重計算
- [ ] 3. 分數計算與排序
- [ ] 4. Hashtag 生成
- [ ] 5. 預覽文字
- [ ] 6. 地區篩選
- [ ] 7. 功能篩選
- [ ] 8. 熱門咖啡廳推薦
- [ ] 9. 地址與 Google Maps 連結
- [ ] 10. 收藏功能
- [ ] 11. 最近瀏覽紀錄
- [ ] 12. 錯誤回報功能
- [ ] 13. 多語言關鍵字支援

---

## 🎯 Demo 展示流程建議

### 展示順序：

1. **開場**：介紹系統目標與核心功能
2. **基礎搜尋**：展示關鍵字搜尋（不限時、安靜、有插座）
3. **權重展示**：比較不同 Tier 關鍵字的搜尋結果
4. **地區篩選**：選擇大安區並搜尋
5. **功能篩選**：選擇「不限時 + 有插座」
6. **Hashtag**：說明 Hashtag 如何生成
7. **收藏**：示範收藏咖啡廳
8. **熱門推薦**：展示 baseline score 推薦
9. **瀏覽紀錄**：展示歷史記錄功能
10. **錯誤回報**：展示互動功能
11. **結尾**：總結核心技術與資料結構應用

---

## 🛠️ 維護與更新

### 新增咖啡廳

編輯 `src/main/resources/data/cafes.json`：
```json
{
  "id": "cafe_031",
  "name": "新咖啡廳名稱",
  "url": "https://example.com",
  "district": "大安區",
  "address": "臺北市大安區XX路XX號",
  "keywords": "[\"不限時\",\"有插座\",\"安靜\"]",
  "score": 4.5,
  "phone": "02-1234-5678",
  "features": ["不限時", "有插座", "安靜"],
  "hashtags": ["不限時", "安靜", "文青"],
  "preview": "咖啡廳簡介..."
}
```

### 新增關鍵字

編輯 `src/main/resources/data/keywords.json`：
```json
{
  "keyword": "新關鍵字",
  "weight": 2.5,
  "tier": "tier1"
}
```

### 更新基準分數

重新計算：
```bash
# 重新啟動應用程式會自動重新計算
.\mvnw.cmd spring-boot:run
```

---

**測試完成後，你的系統就已經完整實現了所有核心功能！** 🎉
